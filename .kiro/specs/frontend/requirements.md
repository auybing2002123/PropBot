# 需求文档

## 简介

本文档定义了购房决策智能助手前端系统的需求，包括 Vue3 项目结构、5 个核心页面、对话交互和数据可视化。前端采用 Vue3 + Element Plus + ECharts 技术栈，实现响应式设计，为后续小程序适配做准备。

## 术语表

- **Chat_Page**: 对话页面，主入口，支持多角色流式对话
- **Calculator_Page**: 计算器页面，提供贷款、税费、总成本计算表单
- **Market_Page**: 市场分析页面，展示房价走势和区域对比图表
- **Policy_Page**: 政策页面，展示限购限贷等政策列表
- **Profile_Page**: 我的页面，用户中心，包含对话历史和设置
- **Role_Message**: 角色消息组件，展示不同角色的回复（财务顾问/政策专家/市场分析师/购房顾问）
- **SSE_Client**: Server-Sent Events 客户端，处理流式响应

## 需求列表

### 需求 1: 项目基础架构

**用户故事:** 作为开发者，我需要一个规范的 Vue3 项目结构，以便高效开发和维护。

#### 验收标准

1. 项目应使用 Vite 创建，配置 Vue3 + TypeScript
2. 项目应安装并配置 Element Plus 组件库，使用按需导入
3. 项目应安装并配置 Vue Router，支持 5 个页面路由
4. 项目应安装并配置 Pinia 状态管理
5. 项目应配置 axios 实例，设置 baseURL 为 http://localhost:8080/api/v1
6. 项目应配置统一的响应拦截器，处理 code 非 0 的错误

### 需求 2: 整体布局

**用户故事:** 作为用户，我需要清晰的导航布局，以便快速访问各功能模块。

#### 验收标准

1. Layout 应包含顶部导航栏，显示 Logo、标题和城市选择器
2. Layout 应包含底部 Tab 导航，包含对话、计算器、市场、政策、我的 5 个入口
3. 底部导航应使用 Element Plus Icons（ChatDotRound、Calculator、TrendCharts、Document、User）
4. 当切换 Tab 时，Layout 应高亮当前选中项
5. Layout 应支持响应式，移动端使用底部导航，桌面端可选侧边导航

### 需求 3: 对话页面

**用户故事:** 作为用户，我需要与 AI 助手对话，以便获得购房建议。

#### 验收标准

1. Chat_Page 应显示欢迎消息，介绍助手能力
2. Chat_Page 应显示快捷问题按钮（贷款怎么算、限购政策、现在能买吗）
3. 当用户发送消息时，Chat_Page 应调用 POST /api/v1/chat 接口
4. Chat_Page 应使用 SSE 接收流式响应，逐角色展示结果
5. 当收到 role_start 事件时，Chat_Page 应显示角色卡片和加载状态
6. 当收到 role_result 事件时，Chat_Page 应更新角色卡片内容
7. Chat_Page 应支持多轮对话，保持 session_id 一致

### 需求 4: 角色消息组件

**用户故事:** 作为用户，我需要区分不同角色的回复，以便理解多智能体协作。

#### 验收标准

1. Role_Message 应根据角色显示不同图标（Money/Document/TrendCharts/CircleCheck）
2. Role_Message 应根据角色显示不同颜色（绿/蓝/橙/紫）
3. Role_Message 应显示角色名称标签（财务顾问/政策专家/市场分析师/购房顾问）
4. Role_Message 应支持 Markdown 渲染，正确显示列表和强调
5. 用户消息应使用 User 图标和灰色样式

### 需求 5: 计算器页面

**用户故事:** 作为用户，我需要快速计算贷款和税费，以便了解购房成本。

#### 验收标准

1. Calculator_Page 应包含 3 个 Tab：贷款计算、税费计算、总成本
2. 贷款计算 Tab 应包含房价、首付比例、贷款年限、贷款方式、还款方式输入
3. 当点击计算时，贷款计算应调用 POST /api/v1/calc/loan 接口
4. 贷款计算结果应显示首付、贷款金额、月供、总利息、还款总额
5. 税费计算 Tab 应包含房价、面积、是否首套、房龄输入
6. 当点击计算时，税费计算应调用 POST /api/v1/calc/tax 接口
7. 税费计算结果应显示契税、增值税、个税、中介费明细
8. 总成本 Tab 应汇总首付、贷款利息、税费、装修等费用

### 需求 6: 市场分析页面

**用户故事:** 作为用户，我需要查看市场数据，以便了解房价走势。

#### 验收标准

1. Market_Page 应显示城市和区域选择器
2. Market_Page 应显示 4 个数据卡片：均价、环比、成交量、去化周期
3. Market_Page 应使用 ECharts 显示房价走势折线图
4. Market_Page 应显示区域对比表格，包含区域、均价、环比、成交量
5. 当切换城市或区域时，Market_Page 应重新加载数据
6. Market_Page 应包含"咨询 AI"按钮，点击跳转到对话页面

### 需求 7: 政策页面

**用户故事:** 作为用户，我需要查看购房政策，以便了解限购限贷规定。

#### 验收标准

1. Policy_Page 应显示城市选择器
2. Policy_Page 应包含政策分类 Tab：限购政策、公积金、贷款政策、购房流程
3. Policy_Page 应以卡片形式展示政策列表
4. 政策卡片应显示标题、要点摘要、来源、更新时间
5. 政策卡片应包含"咨询 AI"按钮，点击跳转到对话页面并预填问题

### 需求 8: 我的页面

**用户故事:** 作为用户，我需要管理我的对话历史和设置。

#### 验收标准

1. Profile_Page 应显示用户信息卡片（头像、昵称、上次登录）
2. Profile_Page 应显示功能入口列表：对话历史、我的收藏、设置、帮助与反馈
3. 当点击对话历史时，Profile_Page 应调用 GET /api/v1/conversations 获取列表
4. 对话历史列表应显示标题和时间，支持点击查看详情
5. Profile_Page 应显示免责声明提示

### 需求 9: 用户认证

**用户故事:** 作为用户，我需要简单的登录功能，以便保存我的对话历史。

#### 验收标准

1. Auth_Store 应管理用户登录状态（user_id、nickname）
2. 当用户首次访问时，应显示注册弹窗，只需输入昵称
3. 注册成功后，Auth_Store 应保存 user_id 到 localStorage
4. 当用户再次访问时，应自动使用 localStorage 中的 user_id 登录
5. 登录失败时应清除 localStorage 并提示重新注册

### 需求 10: 城市切换

**用户故事:** 作为用户，我需要切换城市，以便查看不同城市的数据。

#### 验收标准

1. City_Store 应管理当前选中城市（默认南宁）
2. 城市选择器应支持南宁和柳州两个选项
3. 当切换城市时，City_Store 应通知相关页面刷新数据
4. 城市选择应持久化到 localStorage

### 需求 11: 错误处理与加载状态

**用户故事:** 作为用户，我需要清晰的加载和错误提示，以便了解系统状态。

#### 验收标准

1. 当发起 API 请求时，应显示加载状态（按钮 loading 或骨架屏）
2. 当 API 返回错误时，应使用 ElMessage.error 显示错误提示
3. 当网络错误时，应显示"网络异常，请稍后重试"
4. 对话页面流式响应出错时，应在消息区显示错误提示

### 需求 12: 视觉规范

**用户故事:** 作为用户，我需要统一美观的界面，以便获得良好的使用体验。

#### 验收标准

1. 主色应使用 #1890ff（蓝色）
2. 角色颜色应遵循：财务顾问 #52c41a、政策专家 #1890ff、市场分析师 #faad14、购房顾问 #722ed1
3. 卡片应使用圆角 12px 和阴影 0 2px 8px rgba(0,0,0,0.08)
4. 不应使用渐变色和 emoji，图标使用 Element Plus Icons
5. 字体应使用系统字体栈，标题 18px/600，正文 14px，辅助 12px
