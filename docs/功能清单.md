# 购房决策智能助手 - 功能清单

## 概述

本文档定义了购房决策智能助手的全部功能模块。

**目标城市**: 广西南宁、柳州  
**项目类型**: 比赛项目（Web应用）  
**架构**: 单Agent + 多工具

---

## 一、核心功能

### 1. 财务规划

| 功能 | 说明 | 输入 | 输出 |
|------|------|------|------|
| 贷款方案计算 | 支持公积金/商贷/组合贷三种方案 | 房价、首付、贷款年限 | 各方案对比 |
| 首付计算 | 根据政策和房价计算首付金额 | 房价、首套/二套、城市 | 首付金额、首付比例 |
| 月供计算 | 支持等额本息/等额本金 | 贷款金额、利率、年限 | 月供金额 |
| 还款计划生成 | 生成逐月/逐年还款明细 | 贷款方案 | 还款计划表 |
| 税费计算 | 契税、增值税、个税、中介费等 | 房价、面积、房龄、首套/二套 | 各项税费明细 |
| 装修费用估算 | 按面积和档次估算 | 面积、装修档次 | 装修费用范围 |
| 物业费计算 | 按小区标准和持有年限 | 面积、物业费单价、年限 | 物业费总额 |
| 其他持有成本 | 停车位、家具家电等 | 配置选项 | 费用估算 |
| 购房总成本汇总 | 汇总所有费用 | 以上各项 | 总成本明细表 |
| 还款压力评估 | 计算月供收入比 | 月供、家庭收入 | 压力等级、建议 |

### 2. 市场分析

| 功能 | 说明 | 输入 | 输出 |
|------|------|------|------|
| 房价走势分析 | 展示历史房价趋势 | 城市、区域 | 走势图、涨跌幅 |
| 成交量分析 | 市场热度判断 | 城市、区域 | 成交量、环比变化 |
| 供需关系分析 | 库存量、去化周期 | 城市 | 库存、去化周期、市场状态 |
| 区域对比分析 | 不同区域横向对比 | 城市、多个区域 | 对比表格 |
| 购房时机判断 | 综合评分 | 城市、区域 | 时机评分、建议 |
| 政策影响评估 | 分析政策对市场的影响 | 政策内容 | 影响分析 |

### 3. 购房建议

| 功能 | 说明 | 输入 | 输出 |
|------|------|------|------|
| 综合分析报告 | 整合财务+市场分析 | 用户完整信息 | 分析报告 |
| 购房时机建议 | 基于市场判断给出建议 | 市场分析结果 | 时机建议 |
| 风险提示 | 提示潜在风险 | 用户情况、市场情况 | 风险清单 |
| 下一步行动建议 | 具体可执行的建议 | 分析结果 | 行动清单 |

### 4. 知识问答

| 功能 | 说明 | 数据来源 |
|------|------|---------|
| 限购限贷政策咨询 | 回答购房资格、限购套数等 | 知识库（RAG） |
| 贷款知识问答 | 公积金、商贷、组合贷等问题 | 知识库（RAG） |
| 购房流程指导 | 从看房到交房的全流程 | 知识库（RAG） |
| 常见问题解答 | FAQ | 知识库（RAG） |
| 最新政策新闻 | 实时获取最新政策动态 | 联网工具 |

---

## 二、辅助功能

### 5. 用户管理

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 用户注册 | 用户名+密码注册，昵称可选 | 高 |
| 用户登录 | 用户名+密码登录 | 高 |
| 对话历史记录 | 保存历史对话，支持查看 | 高 |
| 收藏功能 | 收藏分析结果或房源 | 低 |

#### 用户认证 API

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/auth/register` | POST | 用户注册（返回 user_id） |
| `/api/v1/auth/login` | POST | 用户登录（验证 user_id） |
| `/api/v1/auth/me` | GET | 获取当前用户信息 |

#### 对话历史 API

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/conversations` | GET | 获取对话列表 |
| `/api/v1/conversations` | POST | 创建新对话 |
| `/api/v1/conversations/{id}` | GET | 获取对话详情（含消息） |
| `/api/v1/conversations/{id}` | PUT | 更新对话标题 |
| `/api/v1/conversations/{id}` | DELETE | 删除对话 |
| `/api/v1/conversations/{id}/messages` | GET | 获取消息列表 |

---

## 三、工具清单

基于单Agent架构，以下是Agent可调用的工具：

| 工具名 | 功能 | 类型 |
|--------|------|------|
| `calc_loan` | 贷款计算（公积金/商贷/组合贷） | 计算 |
| `calc_monthly_payment` | 月供计算（等额本息/等额本金） | 计算 |
| `generate_repayment_plan` | 生成还款计划 | 计算 |
| `calc_tax` | 税费计算 | 计算 |
| `calc_total_cost` | 购房总成本汇总 | 计算 |
| `assess_pressure` | 还款压力评估 | 计算 |
| `query_market` | 查询市场数据（房价、成交、供需） | 查询 |
| `query_price_trend` | 查询房价走势 | 查询 |
| `compare_districts` | 区域对比分析 | 分析 |
| `judge_timing` | 购房时机判断 | 分析 |
| `search_policy` | 政策知识检索（RAG） | 检索 |
| `search_faq` | FAQ检索（RAG） | 检索 |
| `search_guide` | 购房流程检索（RAG） | 检索 |
| `search_news` | 搜索最新政策新闻 | 联网 |
| `generate_report` | 生成综合分析报告 | 生成 |

---

## 四、功能实现状态

### 财务规划模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 贷款方案计算 | 告诉你贷多少钱、每月还多少、总共还多少利息 | ✅ 已实现 | `calc_loan` | 💰 财务顾问 |
| 首付计算 | 根据房价和政策算出你需要准备多少首付款 | ✅ 已实现 | `calc_loan` (含首付) | 💰 财务顾问 |
| 月供计算 | 算出每个月要还银行多少钱 | ✅ 已实现 | `calc_loan` | 💰 财务顾问 |
| 还款计划生成 | 生成一张表，列出每月/每年要还的本金和利息 | ✅ 已实现 | `generate_repayment_plan` | 💰 财务顾问 |
| 税费计算 | 买房要交的契税、增值税、个税、中介费等一共多少 | ✅ 已实现 | `calc_tax` | 💰 财务顾问 |
| 装修费用估算 | 根据面积和装修档次估算装修要花多少钱 | ⚠️ 部分实现 | `calc_total_cost` (可选参数) | 💰 财务顾问 |
| 物业费计算 | 算出每年要交多少物业费 | ❌ 未实现 | - | 💰 财务顾问 |
| 其他持有成本 | 停车位、家具家电等额外花费 | ⚠️ 部分实现 | `calc_total_cost` (other_fees) | 💰 财务顾问 |
| 购房总成本汇总 | 把首付+贷款+税费+装修等所有费用加起来 | ✅ 已实现 | `calc_total_cost` | 💰 财务顾问 |
| 还款压力评估 | 判断你的收入能不能轻松还得起房贷 | ✅ 已实现 | `assess_pressure` | 💰 财务顾问 |

### 市场分析模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 房价走势分析 | 看看这个区域房价是涨了还是跌了 | ✅ 已实现 | `query_price_trend` | 📈 市场分析师 |
| 成交量分析 | 看看最近有多少人在买房，市场热不热 | ✅ 已实现 | `query_market` | 📈 市场分析师 |
| 供需关系分析 | 看看房子多不多、好不好卖 | ✅ 已实现 | `query_market` (库存/去化) | 📈 市场分析师 |
| 区域对比分析 | 把几个区放一起比，看哪个更值得买 | ✅ 已实现 | `compare_districts` | 📈 市场分析师 |
| 购房时机判断 | 告诉你现在买房是好时机还是该再等等 | ✅ 已实现 | `judge_timing` | 📈 市场分析师 |
| 政策影响评估 | 分析新政策出来后对房价有什么影响 | ⚠️ 部分实现 | `judge_timing` (policy 评分) | 📈 市场分析师 |

### 购房建议模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 综合分析报告 | 把你的财务情况和市场情况整合成一份完整报告 | ✅ 已实现 | `generate_report` | ✅ 购房顾问 |
| 购房时机建议 | 根据市场情况给你买房时机的建议 | ✅ 已实现 | `judge_timing` | 📈 市场分析师 |
| 风险提示 | 提醒你买房可能遇到的坑和风险 | ✅ 已实现 | `generate_report` (risk_factors) | ✅ 购房顾问 |
| 下一步行动建议 | 告诉你接下来该做什么，比如准备什么材料 | ✅ 已实现 | `generate_report` (next_steps) | ✅ 购房顾问 |

### 知识问答模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 限购限贷政策咨询 | 回答"我能不能买房"、"能买几套"等问题 | ✅ 已实现 | `search_policy` | 📋 政策专家 |
| 贷款知识问答 | 回答公积金怎么贷、商贷利率多少等问题 | ✅ 已实现 | `search_faq` | 📋 政策专家 |
| 购房流程指导 | 告诉你从看房到拿钥匙要经过哪些步骤 | ✅ 已实现 | `search_guide` | 📋 政策专家 |
| 常见问题解答 | 回答买房过程中的各种常见问题 | ✅ 已实现 | `search_faq` | 📋 政策专家 |
| 最新政策新闻 | 查询最近有什么新的房产政策出台 | ✅ 已实现 | `search_news` (模拟数据) | 📈 市场分析师 |

### 角色说明

| 角色 | 图标 | 职责 | 负责工具 |
|------|------|------|---------|
| 财务顾问 | 💰 | 贷款计算、税费分析、还款压力评估 | `calc_loan`, `calc_tax`, `calc_total_cost`, `assess_pressure`, `generate_repayment_plan` |
| 政策专家 | 📋 | 政策检索、FAQ问答、流程指导 | `search_policy`, `search_faq`, `search_guide` |
| 市场分析师 | 📈 | 市场查询、走势分析、区域对比、时机判断 | `query_market`, `query_price_trend`, `compare_districts`, `judge_timing`, `search_news` |
| 购房顾问 | ✅ | 整合各角色结果，生成综合建议 | `generate_report` |

### 实现统计

| 统计项 | 数量/比例 |
|-------|----------|
| 总功能数 | 24 |
| 已完全实现 | 20 (83%) |
| 部分实现 | 3 (13%) |
| 未实现 | 1 (4%) |

**待完善功能：**
1. `物业费计算` - 可加入 `calc_total_cost` 或单独实现
2. `装修费用估算` - 目前只是可选参数，缺少独立估算逻辑
3. `政策影响评估` - 目前只有简单的政策评分，缺少深度分析

---

## 五、功能优先级

### P0 - 必须实现（MVP）

- [x] 贷款方案计算
- [x] 月供计算
- [x] 税费计算
- [x] 购房总成本汇总
- [x] 还款压力评估
- [x] 限购限贷政策问答
- [x] 购房流程指导
- [x] 智能对话（Agent调度）

### P1 - 重要功能

- [x] 还款计划生成
- [x] 房价走势分析
- [x] 区域对比分析
- [x] 供需关系分析
- [x] 购房时机判断
- [x] 综合分析报告
- [x] 最新政策新闻（联网）

### P2 - 增强功能

- [ ] 装修费用估算（部分实现）
- [ ] 物业费计算
- [ ] 其他持有成本（部分实现）
- [x] 对话历史记录
- [ ] 收藏功能
- [ ] 房源展示与筛选
- [ ] 房源推荐评分

---

## 六、交互入口

| 入口 | 说明 | 优先级 |
|------|------|--------|
| 智能对话 | 主入口，自由问答，Agent自动调度工具 | P0 |
| 贷款计算器 | 快捷工具，表单输入直接计算 | P0 |
| 市场分析 | 查看房价走势、区域对比 | P1 |
| 政策查询 | 按城市查询限购限贷政策 | P1 |
| 我的 | 历史记录、收藏 | P2 |

---

## 七、典型使用场景

### 场景1：财务规划咨询

```
用户: "我想在南宁买一套150万的房子，首套房，月收入1.5万，能负担得起吗？"

系统调用工具:
1. calc_loan → 计算贷款方案
2. calc_tax → 计算税费
3. calc_total_cost → 汇总总成本
4. assess_pressure → 评估还款压力

输出: 首付、月供、总成本、还款压力评估、建议
```

### 场景2：政策咨询

```
用户: "南宁现在还限购吗？外地人能买几套？"

系统调用工具:
1. search_policy → RAG检索限购政策

输出: 南宁限购政策详情
```

### 场景3：市场分析

```
用户: "青秀区和良庆区哪个更值得买？"

系统调用工具:
1. query_market → 查询两个区的市场数据
2. compare_districts → 对比分析
3. judge_timing → 时机判断

输出: 两区对比表、购房建议
```

### 场景4：最新政策

```
用户: "最近南宁有什么新的房产政策吗？"

系统调用工具:
1. search_news → 联网搜索最新新闻

输出: 最新政策新闻摘要
```
