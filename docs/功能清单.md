# 房产智能助手 - 功能清单

## 概述

本文档定义了房产智能助手的全部功能模块。

**目标城市**: 广西南宁、柳州  
**项目类型**: 比赛项目（Web应用）  
**架构**: 单Agent + 多工具 + 多助手

---

## 助手矩阵（多场景覆盖）

| 助手 | 图标 | 核心场景 | 状态 | 主要功能 |
|------|------|---------|------|---------|
| 购房助手 | 🏠 | 买房决策 | ✅ 已实现 | 贷款计算、税费分析、政策咨询、市场分析 |
| 租房助手 | 🔑 | 租房找房 | 🔜 规划中 | 租金估算、区域推荐、合同审查 |
| 学区房助手 | 🎓 | 学区匹配 | 🔜 规划中 | 学校查询、学区划分、房源匹配 |
| 验房助手 | 🔍 | 收房验房 | 🔜 规划中 | 验房清单、问题识别、维权指导 |
| 商业选址 | 🏢 | 商铺投资 | 🔜 规划中 | 人流分析、租金回报、竞品分析 |
| 租赁管理 | 📋 | 房东管理 | 🔜 规划中 | 租客管理、收租提醒、合同管理 |

---

## 一、核心功能

### 1. 财务规划

| 功能 | 说明 | 输入 | 输出 |
|------|------|------|------|
| 贷款方案计算 | 支持公积金/商贷/组合贷三种方案 | 房价、首付、贷款年限 | 各方案对比 |
| 首付计算 | 根据政策和房价计算首付金额 | 房价、首套/二套、城市 | 首付金额、首付比例 |
| 月供计算 | 支持等额本息/等额本金 | 贷款金额、利率、年限 | 月供金额 |
| 还款计划生成 | 生成逐月/逐年还款明细 | 贷款方案 | 还款计划表 |
| 税费计算 | 契税、增值税、个税、中介费等 | 房价、面积、房龄、首套/二套 | 各项税费明细 |
| 装修费用估算 | 按面积和档次估算 | 面积、装修档次 | 装修费用范围 |
| 物业费计算 | 按小区标准和持有年限 | 面积、物业费单价、年限 | 物业费总额 |
| 其他持有成本 | 停车位、家具家电等 | 配置选项 | 费用估算 |
| 购房总成本汇总 | 汇总所有费用 | 以上各项 | 总成本明细表 |
| 还款压力评估 | 计算月供收入比 | 月供、家庭收入 | 压力等级、建议 |

### 2. 市场分析

| 功能 | 说明 | 输入 | 输出 |
|------|------|------|------|
| 房价走势分析 | 展示历史房价趋势 | 城市、区域 | 走势图、涨跌幅 |
| 成交量分析 | 市场热度判断 | 城市、区域 | 成交量、环比变化 |
| 供需关系分析 | 库存量、去化周期 | 城市 | 库存、去化周期、市场状态 |
| 区域对比分析 | 不同区域横向对比 | 城市、多个区域 | 对比表格 |
| 购房时机判断 | 综合评分 | 城市、区域 | 时机评分、建议 |
| 政策影响评估 | 分析政策对市场的影响 | 政策内容 | 影响分析 |

### 3. 购房建议

| 功能 | 说明 | 输入 | 输出 |
|------|------|------|------|
| 综合分析报告 | 整合财务+市场分析 | 用户完整信息 | 分析报告 |
| 购房时机建议 | 基于市场判断给出建议 | 市场分析结果 | 时机建议 |
| 风险提示 | 提示潜在风险 | 用户情况、市场情况 | 风险清单 |
| 下一步行动建议 | 具体可执行的建议 | 分析结果 | 行动清单 |

### 4. 知识问答

| 功能 | 说明 | 数据来源 |
|------|------|---------|
| 限购限贷政策咨询 | 回答购房资格、限购套数等 | 知识库（RAG） |
| 贷款知识问答 | 公积金、商贷、组合贷等问题 | 知识库（RAG） |
| 购房流程指导 | 从看房到交房的全流程 | 知识库（RAG） |
| 常见问题解答 | FAQ | 知识库（RAG） |
| 最新政策新闻 | 实时获取最新政策动态 | 联网工具 |

---

## 二、辅助功能

### 5. 用户管理

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 用户注册 | 用户名+密码注册，昵称可选 | 高 |
| 用户登录 | 用户名+密码登录 | 高 |
| 对话历史记录 | 保存历史对话，支持查看 | 高 |
| 关注功能 | 关注问答对，方便快速参考 | 低（✅ 已实现） |

#### 用户认证 API

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/auth/register` | POST | 用户注册（返回 user_id） |
| `/api/v1/auth/login` | POST | 用户登录（验证 user_id） |
| `/api/v1/auth/me` | GET | 获取当前用户信息 |

#### 对话历史 API

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/conversations` | GET | 获取对话列表 |
| `/api/v1/conversations` | POST | 创建新对话 |
| `/api/v1/conversations/{id}` | GET | 获取对话详情（含消息） |
| `/api/v1/conversations/{id}` | PUT | 更新对话标题 |
| `/api/v1/conversations/{id}` | DELETE | 删除对话 |
| `/api/v1/conversations/{id}/messages` | GET | 获取消息列表 |

#### 关注功能 API

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/v1/favorites` | GET | 获取用户关注列表 |
| `/api/v1/favorites` | POST | 添加关注（问答对） |
| `/api/v1/favorites/{id}` | DELETE | 删除关注 |

---

## 三、工具清单

基于单Agent架构，以下是Agent可调用的工具：

| 工具名 | 功能 | 类型 |
|--------|------|------|
| `calc_loan` | 贷款计算（公积金/商贷/组合贷） | 计算 |
| `calc_monthly_payment` | 月供计算（等额本息/等额本金） | 计算 |
| `generate_repayment_plan` | 生成还款计划 | 计算 |
| `calc_tax` | 税费计算 | 计算 |
| `calc_total_cost` | 购房总成本汇总 | 计算 |
| `assess_pressure` | 还款压力评估 | 计算 |
| `query_market` | 查询市场数据（房价、成交、供需） | 查询 |
| `query_price_trend` | 查询房价走势 | 查询 |
| `compare_districts` | 区域对比分析 | 分析 |
| `judge_timing` | 购房时机判断 | 分析 |
| `search_policy` | 政策知识检索（RAG） | 检索 |
| `search_faq` | FAQ检索（RAG） | 检索 |
| `search_guide` | 购房流程检索（RAG） | 检索 |
| `search_news` | 搜索最新政策新闻 | 联网 |
| `generate_report` | 生成综合分析报告 | 生成 |

---

## 四、功能实现状态

### 财务规划模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 贷款方案计算 | 告诉你贷多少钱、每月还多少、总共还多少利息 | ✅ 已实现 | `calc_loan` | 💰 财务顾问 |
| 首付计算 | 根据房价和政策算出你需要准备多少首付款 | ✅ 已实现 | `calc_loan` (含首付) | 💰 财务顾问 |
| 月供计算 | 算出每个月要还银行多少钱 | ✅ 已实现 | `calc_loan` | 💰 财务顾问 |
| 还款计划生成 | 生成一张表，列出每月/每年要还的本金和利息 | ✅ 已实现 | `generate_repayment_plan` | 💰 财务顾问 |
| 税费计算 | 买房要交的契税、增值税、个税、中介费等一共多少 | ✅ 已实现 | `calc_tax` | 💰 财务顾问 |
| 装修费用估算 | 根据面积和装修档次估算装修要花多少钱 | ⚠️ 部分实现 | `calc_total_cost` (可选参数) | 💰 财务顾问 |
| 物业费计算 | 算出每年要交多少物业费 | ❌ 未实现 | - | 💰 财务顾问 |
| 其他持有成本 | 停车位、家具家电等额外花费 | ⚠️ 部分实现 | `calc_total_cost` (other_fees) | 💰 财务顾问 |
| 购房总成本汇总 | 把首付+贷款+税费+装修等所有费用加起来 | ✅ 已实现 | `calc_total_cost` | 💰 财务顾问 |
| 还款压力评估 | 判断你的收入能不能轻松还得起房贷 | ✅ 已实现 | `assess_pressure` | 💰 财务顾问 |

### 市场分析模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 房价走势分析 | 看看这个区域房价是涨了还是跌了 | ✅ 已实现 | `query_price_trend` | 📈 市场分析师 |
| 成交量分析 | 看看最近有多少人在买房，市场热不热 | ✅ 已实现 | `query_market` | 📈 市场分析师 |
| 供需关系分析 | 看看房子多不多、好不好卖 | ✅ 已实现 | `query_market` (库存/去化) | 📈 市场分析师 |
| 区域对比分析 | 把几个区放一起比，看哪个更值得买 | ✅ 已实现 | `compare_districts` | 📈 市场分析师 |
| 购房时机判断 | 告诉你现在买房是好时机还是该再等等 | ✅ 已实现 | `judge_timing` | 📈 市场分析师 |
| 政策影响评估 | 分析新政策出来后对房价有什么影响 | ⚠️ 部分实现 | `judge_timing` (policy 评分) | 📈 市场分析师 |

### 购房建议模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 综合分析报告 | 把你的财务情况和市场情况整合成一份完整报告 | ✅ 已实现 | `generate_report` | ✅ 购房顾问 |
| 购房时机建议 | 根据市场情况给你买房时机的建议 | ✅ 已实现 | `judge_timing` | 📈 市场分析师 |
| 风险提示 | 提醒你买房可能遇到的坑和风险 | ✅ 已实现 | `generate_report` (risk_factors) | ✅ 购房顾问 |
| 下一步行动建议 | 告诉你接下来该做什么，比如准备什么材料 | ✅ 已实现 | `generate_report` (next_steps) | ✅ 购房顾问 |

### 知识问答模块

| 功能 | 通俗解释 | 状态 | 对应工具 | 对应角色 |
|------|---------|------|---------|---------|
| 限购限贷政策咨询 | 回答"我能不能买房"、"能买几套"等问题 | ✅ 已实现 | `search_policy` | 📋 政策专家 |
| 贷款知识问答 | 回答公积金怎么贷、商贷利率多少等问题 | ✅ 已实现 | `search_faq` | 📋 政策专家 |
| 购房流程指导 | 告诉你从看房到拿钥匙要经过哪些步骤 | ✅ 已实现 | `search_guide` | 📋 政策专家 |
| 常见问题解答 | 回答买房过程中的各种常见问题 | ✅ 已实现 | `search_faq` | 📋 政策专家 |
| 最新政策新闻 | 查询最近有什么新的房产政策出台 | ✅ 已实现 | `search_news` (模拟数据) | 📈 市场分析师 |

### 角色说明

| 角色 | 图标 | 职责 | 负责工具 |
|------|------|------|---------|
| 财务顾问 | 💰 | 贷款计算、税费分析、还款压力评估 | `calc_loan`, `calc_tax`, `calc_total_cost`, `assess_pressure`, `generate_repayment_plan` |
| 政策专家 | 📋 | 政策检索、FAQ问答、流程指导 | `search_policy`, `search_faq`, `search_guide` |
| 市场分析师 | 📈 | 市场查询、走势分析、区域对比、时机判断 | `query_market`, `query_price_trend`, `compare_districts`, `judge_timing`, `search_news` |
| 购房顾问 | ✅ | 整合各角色结果，生成综合建议 | `generate_report` |

### 实现统计

| 统计项 | 数量/比例 |
|-------|----------|
| 总功能数 | 24 |
| 已完全实现 | 20 (83%) |
| 部分实现 | 3 (13%) |
| 未实现 | 1 (4%) |

**待完善功能：**
1. `物业费计算` - 可加入 `calc_total_cost` 或单独实现
2. `装修费用估算` - 目前只是可选参数，缺少独立估算逻辑
3. `政策影响评估` - 目前只有简单的政策评分，缺少深度分析

---

## 五、功能优先级

### P0 - 必须实现（MVP）

- [x] 贷款方案计算
- [x] 月供计算
- [x] 税费计算
- [x] 购房总成本汇总
- [x] 还款压力评估
- [x] 限购限贷政策问答
- [x] 购房流程指导
- [x] 智能对话（Agent调度）

### P1 - 重要功能

- [x] 还款计划生成
- [x] 房价走势分析
- [x] 区域对比分析
- [x] 供需关系分析
- [x] 购房时机判断
- [x] 综合分析报告
- [x] 最新政策新闻（联网）

### P2 - 增强功能

- [ ] 装修费用估算（部分实现）
- [ ] 物业费计算
- [ ] 其他持有成本（部分实现）
- [x] 对话历史记录
- [x] 关注功能（问答对关注）
- [ ] 房源展示与筛选
- [ ] 房源推荐评分

---

## 六、交互入口

| 入口 | 说明 | 优先级 |
|------|------|--------|
| 智能对话 | 主入口，自由问答，Agent自动调度工具 | P0 |
| 贷款计算器 | 快捷工具，表单输入直接计算 | P0 |
| 市场分析 | 查看房价走势、区域对比 | P1 |
| 政策查询 | 按城市查询限购限贷政策 | P1 |
| 关注面板 | 右下角悬浮按钮，展开查看关注的问答对 | P2 |
| 我的 | 历史记录、个人设置 | P2 |

---

## 七、典型使用场景

### 场景1：财务规划咨询

```
用户: "我想在南宁买一套150万的房子，首套房，月收入1.5万，能负担得起吗？"

系统调用工具:
1. calc_loan → 计算贷款方案
2. calc_tax → 计算税费
3. calc_total_cost → 汇总总成本
4. assess_pressure → 评估还款压力

输出: 首付、月供、总成本、还款压力评估、建议
```

### 场景2：政策咨询

```
用户: "南宁现在还限购吗？外地人能买几套？"

系统调用工具:
1. search_policy → RAG检索限购政策

输出: 南宁限购政策详情
```

### 场景3：市场分析

```
用户: "青秀区和良庆区哪个更值得买？"

系统调用工具:
1. query_market → 查询两个区的市场数据
2. compare_districts → 对比分析
3. judge_timing → 时机判断

输出: 两区对比表、购房建议
```

### 场景4：最新政策

```
用户: "最近南宁有什么新的房产政策吗？"

系统调用工具:
1. search_news → 联网搜索最新新闻

输出: 最新政策新闻摘要
```

### 场景5：关注问答

```
用户在对话中看到一条有价值的AI回复

操作步骤:
1. 点击AI回复右上角的星星图标 → 关注该问答对
2. 点击右下角悬浮按钮 → 展开关注面板
3. 查看关注的问答列表，支持删除

功能特点:
- 自动提取用户问题和AI完整回答
- 按时间倒序排列
- 跨设备同步（存储在后端数据库）
```


---

## 八、多助手规划（后期开发）

### 1. 租房助手 🔑

| 功能 | 说明 | 工具 |
|------|------|------|
| 租金估算 | 根据区域、面积、装修估算合理租金 | `estimate_rent` |
| 区域推荐 | 根据工作地点、预算推荐租房区域 | `recommend_area` |
| 合同审查 | 检查租房合同常见陷阱 | `check_contract` |
| 租房流程 | 从找房到入住的全流程指导 | `search_guide` |
| 押金计算 | 押一付三等各种付款方式计算 | `calc_deposit` |

角色：租房顾问、法务专家

### 2. 学区房助手 🎓

| 功能 | 说明 | 工具 |
|------|------|------|
| 学校查询 | 查询学校信息、排名、升学率 | `query_school` |
| 学区划分 | 查询小区对应的学区 | `query_district` |
| 房源匹配 | 根据目标学校推荐房源 | `match_houses` |
| 入学政策 | 户籍、年限等入学要求 | `search_policy` |
| 学区房价 | 学区房价格走势分析 | `query_price_trend` |

角色：教育顾问、房产顾问

### 3. 验房助手 🔍

| 功能 | 说明 | 工具 |
|------|------|------|
| 验房清单 | 生成验房检查清单 | `generate_checklist` |
| 问题识别 | 常见房屋问题识别指导 | `identify_issues` |
| 维权指导 | 发现问题后的维权流程 | `guide_rights` |
| 整改跟踪 | 记录问题和整改进度 | `track_issues` |
| 交房流程 | 收房验房全流程指导 | `search_guide` |

角色：验房专家、法务顾问

### 4. 商业选址 🏢

| 功能 | 说明 | 工具 |
|------|------|------|
| 人流分析 | 分析区域人流量和消费能力 | `analyze_traffic` |
| 租金回报 | 计算商铺投资回报率 | `calc_roi` |
| 竞品分析 | 周边同类商铺分析 | `analyze_competitors` |
| 业态建议 | 根据区域特点推荐适合业态 | `recommend_business` |
| 政策优惠 | 商业地产相关优惠政策 | `search_policy` |

角色：投资顾问、市场分析师

### 5. 租赁管理 📋

| 功能 | 说明 | 工具 |
|------|------|------|
| 租客管理 | 租客信息、合同管理 | `manage_tenants` |
| 收租提醒 | 租金到期提醒 | `remind_rent` |
| 合同管理 | 合同生成、续签、到期提醒 | `manage_contracts` |
| 维修记录 | 房屋维修记录和费用 | `track_maintenance` |
| 收益统计 | 租金收入、支出统计 | `calc_income` |

角色：租赁管家、法务顾问

---

## 九、技术实现方案（多助手）

### 架构设计

```
┌─────────────────────────────────────────────┐
│                   前端                       │
│  ┌─────────────────────────────────────┐   │
│  │  助手选择器（输入框上方）              │   │
│  │  [购房] [租房] [学区房] [验房] ...    │   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────┐
│                   后端                       │
│  ┌─────────────────────────────────────┐   │
│  │           助手路由层                  │   │
│  │  根据 assistant_id 分发到对应助手     │   │
│  └─────────────────────────────────────┘   │
│                      │                      │
│    ┌─────────┬───────┴───────┬─────────┐   │
│    ▼         ▼               ▼         ▼   │
│ ┌──────┐ ┌──────┐       ┌──────┐ ┌──────┐ │
│ │购房  │ │租房  │  ...  │商业  │ │租赁  │ │
│ │助手  │ │助手  │       │选址  │ │管理  │ │
│ └──────┘ └──────┘       └──────┘ └──────┘ │
│    │         │               │         │   │
│    ▼         ▼               ▼         ▼   │
│ ┌──────────────────────────────────────┐   │
│ │           共享基础设施                 │   │
│ │  - LLM Client                        │   │
│ │  - 向量数据库                         │   │
│ │  - 用户管理                           │   │
│ │  - 对话历史                           │   │
│ └──────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

### 数据库扩展

```sql
-- 对话表增加 assistant_id 字段
ALTER TABLE conversations ADD COLUMN assistant_id VARCHAR(32) DEFAULT 'purchase';

-- 助手配置表（可选，也可用代码配置）
CREATE TABLE assistants (
    id VARCHAR(32) PRIMARY KEY,
    name VARCHAR(64) NOT NULL,
    description TEXT,
    icon VARCHAR(16),
    is_active BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### API 扩展

```
POST /api/v1/chat
{
    "message": "...",
    "conversation_id": "...",
    "assistant_id": "purchase"  // 新增：指定助手
}
```
