# 购房决策智能助手 - 需求文档

## 一、项目背景

### 1.1 项目定位
针对年轻人不买房的现状，构建一个**多智能体问答决策系统**，帮助用户做出科学的购房决策。

**项目类型**: 比赛项目  
**目标城市**: 广西南宁、柳州  
**技术架构**: 多智能体协作（财务顾问、政策专家、市场分析师、购房顾问）  
**前端形态**: Web应用（一期），微信小程序（二期）

> **相关文档**：
> - [数据需求文档.md](数据需求文档.md) - 完整数据结构定义
> - [功能清单.md](功能清单.md) - 功能列表和工具清单
> - [架构设计文档.md](架构设计文档.md) - 技术架构设计
> - [技术实现方案.md](技术实现方案.md) - 具体实现方案

### 1.2 目标用户
- 有购房意向但缺乏专业知识的年轻人
- 需要了解购房政策、贷款方案、市场行情的用户
- 希望获得个性化购房建议的用户

### 1.3 核心价值
- 提供足够多的信息帮助用户了解购房全流程
- 分析最佳购房时机
- 计算购房综合成本
- 提供个性化建议

---

## 二、功能需求

### 2.1 核心功能模块

#### 2.1.1 用户需求解析
- 通过对话收集用户信息（预算、区域、户型、收入等）
- 构建用户画像
- 识别用户真实需求

#### 2.1.2 市场分析
- 房价走势分析（历史房价趋势）
- 成交量分析（市场热度判断）
- 供需关系分析（库存量、去化周期）
- 区域对比分析
- 购房时机判断（综合评分）
- 政策影响评估

#### 2.1.3 财务规划
- 贷款方案计算（公积金/商贷/组合贷）
- 首付计算（根据政策和房价）
- 月供计算（等额本息/等额本金）
- 还款计划生成（逐月/逐年还款明细）
- 税费计算（契税、增值税、个税、中介费等）
- 装修费用估算（按面积和档次）
- 物业费计算（按小区标准和持有年限）
- 其他持有成本（停车位、家具家电等）
- 购房总成本汇总
- 还款压力评估（月供收入比）

#### 2.1.4 购房建议
- 综合分析报告
- 购房时机建议
- 风险提示
- 下一步行动建议

### 2.2 辅助功能

#### 2.2.1 知识问答
- 购房政策咨询（限购、限贷）
- 贷款知识问答
- 购房流程指导
- 常见问题解答

#### 2.2.2 用户管理
- Web端登录（简化）
- 对话历史记录
- 收藏功能（可选）

---

## 三、数据架构

> **详细数据需求请参考：[数据需求文档.md](数据需求文档.md)**
>
> 本节为数据架构概览，完整的数据结构定义、字段说明、文件清单见数据需求文档。

### 3.1 数据分层概览

```
┌─────────────────────────────────────────────────────────────┐
│                        数据架构                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【知识库 - RAG检索】Chroma向量数据库                         │
│  ├─ 购房政策文档（限购、限贷原文及解读）                       │
│  ├─ FAQ问答对（常见问题）                                     │
│  ├─ 购房流程指南                                             │
│  └─ 政策新闻（重要历史政策 + 联网获取最新）                    │
│  → 用途：语义检索，回答政策咨询、流程问题                      │
│                                                             │
│  【业务数据 - 精确查询/计算】PostgreSQL                        │
│  ├─ 配置数据：利率、税费规则、费用标准                        │
│  ├─ 市场数据：房价指数、成交统计                              │
│  └─ 用户数据：对话历史（简化）                                │
│  → 用途：财务计算、市场分析                                   │
│                                                             │
│  【会话数据 - 临时存储】Redis                                   │
│  └─ 用户当次输入的房源信息、对话上下文                        │
│  → 用途：单次对话分析，不持久化                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 知识库数据（RAG检索）

> 存储位置：Chroma向量数据库
> 使用场景：政策咨询、知识问答、流程指导

#### 3.2.1 购房政策文档

用于回答限购、限贷等政策问题，支持语义检索。

```json
{
  "doc_id": "POLICY_BJ_001",
  "city": "北京",
  "category": "限购政策",
  "title": "北京市住房限购政策",
  "content": "北京市户籍单身人士限购1套，家庭限购2套；非京籍需连续缴纳60个月社保或个税，限购1套...",
  "source": "北京市住建委",
  "publish_date": "2024-09-30",
  "update_date": "2024-09-30",
  "keywords": ["限购", "北京", "购房资格", "社保"]
}
```

#### 3.2.2 FAQ问答对

```json
{
  "faq_id": "FAQ_001",
  "category": "贷款",
  "question": "公积金贷款和商业贷款可以组合吗？",
  "answer": "可以。组合贷款是指同时使用公积金贷款和商业贷款，公积金额度不足时用商贷补充...",
  "keywords": ["组合贷", "公积金", "商业贷款"],
  "related_faqs": ["FAQ_002", "FAQ_003"]
}
```

#### 3.2.3 购房流程指南

```json
{
  "guide_id": "GUIDE_001",
  "title": "北京二手房购买全流程",
  "content": "第一步：资质审核，确认购房资格...",
  "steps": [
    {
      "step": 1,
      "name": "资质审核",
      "description": "确认购房资格，准备社保/个税证明",
      "duration": "1-3天",
      "documents": ["身份证", "户口本", "社保证明"]
    },
    {
      "step": 2,
      "name": "看房选房",
      "description": "实地看房，对比多套房源",
      "duration": "1-4周"
    },
    {
      "step": 3,
      "name": "签订合同",
      "description": "与卖方签订购房合同，支付定金",
      "duration": "1-3天"
    },
    {
      "step": 4,
      "name": "贷款申请",
      "description": "向银行申请贷款，等待审批",
      "duration": "2-4周"
    },
    {
      "step": 5,
      "name": "过户缴税",
      "description": "办理房屋过户，缴纳相关税费",
      "duration": "1-2周"
    },
    {
      "step": 6,
      "name": "交房入住",
      "description": "验收房屋，办理物业交接",
      "duration": "1-3天"
    }
  ]
}
```

#### 3.2.4 政策新闻

```json
{
  "news_id": "NEWS_2024_001",
  "title": "北京优化调整房地产政策",
  "source": "北京住建委",
  "publish_date": "2024-09-30",
  "summary": "取消普通住宅和非普通住宅标准，降低首付比例...",
  "content": "...",
  "impact": "利好",
  "keywords": ["限购放松", "首付降低", "利率下调"]
}
```

### 3.3 业务数据（PostgreSQL）

> 存储位置：PostgreSQL关系数据库
> 使用场景：财务计算、市场分析、用户管理

#### 3.3.1 配置数据 - 贷款利率

用于贷款计算，需要精确数值，不适合RAG。

```json
{
  "id": 1,
  "update_date": "2024-10-21",
  "lpr_1y": 3.10,
  "lpr_5y": 3.60,
  "commercial_first_home": 3.40,
  "commercial_second_home": 3.80,
  "provident_below_5y": 2.35,
  "provident_above_5y": 2.85
}
```

#### 3.3.2 配置数据 - 公积金政策

```json
{
  "city": "北京",
  "single_max_loan": 500000,
  "couple_max_loan": 900000,
  "min_deposit_months": 12,
  "first_home_down_payment_below_90": 0.20,
  "first_home_down_payment_above_90": 0.25,
  "second_home_down_payment": 0.30,
  "update_date": "2024-09-01"
}
```

#### 3.3.3 配置数据 - 税费规则

```json
{
  "deed_tax_first_below_90": 0.01,
  "deed_tax_first_above_90": 0.015,
  "deed_tax_second_below_90": 0.01,
  "deed_tax_second_above_90": 0.02,
  "deed_tax_third": 0.03,
  "vat_below_2y": 0.05,
  "vat_above_2y": 0,
  "income_tax": 0.01,
  "agent_fee_rate": 0.02,
  "registration_fee": 80
}
```

#### 3.3.4 配置数据 - 费用标准

```json
{
  "decoration_cost": {
    "simple": { "min": 800, "max": 1200, "unit": "元/㎡" },
    "medium": { "min": 1500, "max": 2500, "unit": "元/㎡" },
    "luxury": { "min": 3000, "max": 5000, "unit": "元/㎡" }
  },
  "property_fee": {
    "北京": { "min": 2.5, "max": 4.0, "avg": 3.0, "unit": "元/㎡/月" },
    "上海": { "min": 2.0, "max": 3.5, "avg": 2.8, "unit": "元/㎡/月" }
  },
  "parking": {
    "buy": { "min": 150000, "max": 500000, "unit": "元" },
    "rent": { "min": 300, "max": 800, "unit": "元/月" }
  }
}
```

#### 3.3.5 市场数据 - 房价指数

来源：国家统计局 https://data.stats.gov.cn/

```json
{
  "city": "北京",
  "month": "2024-12",
  "new_house_index_mom": 99.8,
  "new_house_index_yoy": 97.5,
  "second_hand_index_mom": 99.5,
  "second_hand_index_yoy": 95.2
}
```

#### 3.3.6 市场数据 - 区域成交统计

```json
{
  "city": "北京",
  "district": "朝阳区",
  "month": "2024-12",
  "avg_price": 62000,
  "transaction_volume": 3500,
  "inventory": 45000,
  "months_of_inventory": 12.8,
  "price_change_mom": -0.5,
  "price_change_yoy": -5.2
}
```

#### 3.3.7 市场数据 - 历史房价走势

```json
{
  "city": "北京",
  "district": "朝阳区",
  "price_history": [
    { "year": 2019, "avg_price": 65000 },
    { "year": 2020, "avg_price": 68000 },
    { "year": 2021, "avg_price": 72000 },
    { "year": 2022, "avg_price": 70000 },
    { "year": 2023, "avg_price": 66000 },
    { "year": 2024, "avg_price": 62000 }
  ]
}
```

#### 3.3.8 用户数据

```json
{
  "user_id": "USER_001",
  "openid": "wx_xxxxx",
  "nickname": "用户昵称",
  "created_at": "2025-01-01",
  "last_login": "2025-01-10"
}
```

### 3.4 会话数据（临时存储）

> 存储位置：Redis或内存
> 使用场景：单次对话分析，对话结束后可清理

#### 3.4.1 用户输入的房源信息

用户主动输入，系统提取结构化信息用于当次分析：

```json
{
  "session_id": "SESSION_001",
  "house_info": {
    "city": "北京",
    "district": "朝阳区",
    "community": "望京西园四区",
    "price_total": 5800000,
    "area": 100.5,
    "layout": "3室2厅1卫",
    "building_year": 2005,
    "floor": "中层/18层"
  }
}
```

#### 3.4.2 用户财务信息（当次对话）

```json
{
  "session_id": "SESSION_001",
  "finance_info": {
    "monthly_income": 30000,
    "spouse_income": 20000,
    "current_savings": 1500000,
    "provident_fund_balance": 150000,
    "provident_fund_monthly": 3000,
    "is_first_home": true
  }
}
```

#### 3.4.3 用户需求信息（当次对话）

```json
{
  "session_id": "SESSION_001",
  "requirement": {
    "budget_min": 4000000,
    "budget_max": 6000000,
    "preferred_districts": ["朝阳区", "海淀区"],
    "area_min": 80,
    "area_max": 120,
    "layout": "3室"
  }
}
```

### 3.5 数据汇总表

| 数据类型 | 存储位置 | 使用场景 | 更新频率 |
|----------|----------|----------|----------|
| 政策文档 | Chroma | RAG问答 | 政策变动时 |
| FAQ问答 | Chroma | RAG问答 | 按需补充 |
| 流程指南 | Chroma | RAG问答 | 低频 |
| 政策新闻 | Chroma | RAG问答 | 实时 |
| 贷款利率 | PostgreSQL | 财务计算 | 月度 |
| 税费规则 | PostgreSQL | 财务计算 | 政策变动时 |
| 公积金政策 | PostgreSQL | 财务计算 | 政策变动时 |
| 费用标准 | PostgreSQL | 成本估算 | 年度 |
| 房价指数 | PostgreSQL | 市场分析 | 月度 |
| 成交统计 | PostgreSQL | 市场分析 | 月度 |
| 用户账户 | PostgreSQL | 用户管理 | 实时 |
| 房源信息 | Redis/内存 | 当次分析 | 会话级 |
| 对话上下文 | Redis/内存 | 多轮对话 | 会话级 |

---

## 四、交互流程

### 4.1 典型对话流程

```
用户: "我想在北京买房"
系统: "好的，我来帮你分析。先了解几个问题：
      1. 你的购房预算大概是多少？
      2. 有没有偏好的区域？
      3. 需要几居室？
      4. 你和配偶的月收入大概多少？"

用户: "预算500-600万，想在朝阳区买个三居室，
      我和老婆月收入5万，公积金交了3年，首套房"

系统: [执行分析流程]
      1. 财务分析结果
      2. 市场分析结果  
      3. 综合建议
```

### 4.2 功能入口

1. **智能对话** - 主入口，自由问答
2. **贷款计算器** - 快捷工具
3. **政策查询** - 按城市查询限购限贷政策
4. **我的** - 历史记录、收藏

---

## 五、非功能需求

### 5.1 性能要求
- 对话响应时间 < 5秒
- 支持并发用户数 > 100

### 5.2 可用性要求
- 服务可用性 > 99%
- 支持7x24小时访问

### 5.3 安全要求
- 用户数据加密存储
- 敏感信息脱敏处理

### 5.4 合规要求
- 数据来源合法合规
- 不提供具体房源推荐（规避中介资质）
- 明确声明"仅供参考，不构成投资建议"



---

## 六、数据来源规划

### 6.1 数据源调研结果

#### 6.1.1 官方/合规数据源

| 数据源 | 类型 | 数据内容 | 获取方式 | 费用 |
|--------|------|----------|----------|------|
| 国家统计局 (data.stats.gov.cn) | 政府公开 | 70城房价指数、房地产开发投资、销售面积等宏观数据 | 网页下载/手动整理 | 免费 |
| 贝壳开放平台 (open.ke.com) | 官方API | 房屋估值(壳e估)、成交案例库、户型分析、房本验真 | API调用 | 付费(企业级) |
| 中指数据 (api.cih-index.com) | 商业API | 土地数据、项目数据、坐标点数据 | API订阅 | 付费 |


⚠️ **风险提示**：
- 链家/贝壳有反爬机制（验证码、IP封禁）
- 商业使用可能违反《反不正当竞争法》
- 数据准确性无法保证
- **本项目不建议采用爬虫方案**

### 6.2 性价比方案（本项目采用）

以下低成本数据获取方案：

#### 6.2.1 免费/低成本数据源

| 数据类型 | 来源 | 获取方式 | 成本 |
|----------|------|----------|------|
| 房价指数 | 国家统计局 | 手动下载CSV/Excel，定期更新 | 免费 |
| 政策信息 | 各地住建局官网 | 人工整理成知识库 | 免费 |
| 贷款利率 | 央行官网/银行官网 | 定期更新静态数据 | 免费 |
| 公积金政策 | 各城市公积金中心官网 | 人工整理 | 免费 |
| 新闻舆情 | 百度新闻API | 搜索"房价+城市名" | 免费额度 |

#### 6.2.2 核心思路：用户输入代替数据爬取

```
原方案：爬取真实房源 → 推荐具体房子（需要大量数据，有法律风险）
    ↓
本项目方案：用户输入信息 → 给出购房建议/时机判断/财务规划（零数据成本）
```

**示例**：
```
用户："我看中了望京西园四区一套90平的房子，挂牌价580万"
系统：基于用户输入的信息进行分析，不需要爬取房源数据
```

### 6.3 数据架构设计

```
┌─────────────────────────────────────────────────────────┐
│                      数据层设计                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  【静态知识库】                【动态数据源】              │
│  ├─ 购房政策文档               ├─ 国家统计局数据          │
│  ├─ 贷款计算规则               │   (定期手动更新)         │
│  ├─ 税费标准                   ├─ LPR利率               │
│  ├─ 公积金政策                 │   (月度更新)            │
│  └─ FAQ问答对                  └─ 用户输入数据           │
│                                    (实时)               │
│                                                         │
│  【LLM知识补充】                                         │
│  └─ DeepSeek/通义千问本身具备大量房产知识                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 6.4 数据获取指南

#### 6.4.1 国家统计局数据
- 网址：https://data.stats.gov.cn/
- 路径：分类数据 → 房地产 → 70个大中城市住宅销售价格指数
- 格式：Excel下载后转为JSON/CSV存入数据库
- 更新频率：每月中旬发布上月数据

#### 6.4.2 LPR贷款利率
- 网址：http://www.pbc.gov.cn/
- 当前利率（2025年1月）：1年期 3.10%，5年期以上 3.60%
- 更新频率：每月20日（如有调整）

#### 6.4.3 公积金政策
- 北京：gjj.beijing.gov.cn
- 上海：shgjj.com
- 广州：gzgjj.gov.cn
- 深圳：gjj.sz.gov.cn
- 整理内容：最高贷款额度、缴存要求、利率等

#### 6.4.4 限购限贷政策
- 来源：各城市住建局官网 + 权威媒体报道
- 整理方式：人工整理成结构化JSON，存入知识库
- 更新频率：政策变动时更新

---

## 七、项目范围

### 7.1 一期：Web应用（MVP）
- [ ] 财务规划功能（贷款计算、税费计算、成本汇总）
- [ ] 政策问答（限购、限贷、公积金）
- [ ] 简单市场分析（基于模拟数据）
- [ ] Web应用基础界面
- [ ] 多智能体对话（财务顾问、政策专家、市场分析师、购房顾问）

### 7.2 二期：微信小程序
- [ ] 微信小程序适配
- [ ] 微信登录
- [ ] 更多城市支持

### 7.3 后续迭代（可选）
- [ ] 市场预测功能
- [ ] 用户社区/问答
- [ ] 房贷还款提醒
