# 公网访问配置指南

本文档介绍如何使用 cpolar 内网穿透工具，让外部用户通过公网访问本地开发环境。

## 前置条件

- 本地前端服务运行在 5173 端口
- 本地后端服务运行在 8080 端口
- 已安装 cpolar（https://www.cpolar.com）

## 一、安装 cpolar

### Windows

1. 下载安装包：https://www.cpolar.com/download
2. 运行安装程序，按提示完成安装
3. 安装后会自动注册为系统服务

### 禁用自动启动（可选）

如果不想 cpolar 开机自启：
1. 按 `Win + R`，输入 `services.msc`
2. 找到 `Cpolar Service`，右键 → 属性
3. 启动类型改为「手动」

手动启停命令：
```powershell
net start cpolar   # 启动
net stop cpolar    # 停止
```

## 二、配置 cpolar

### 1. 注册账号

访问 https://www.cpolar.com 注册账号

### 2. 获取 Token

登录后台 https://dashboard.cpolar.com，点击左侧「验证」菜单，复制 authtoken

### 3. 认证 Token

打开命令行，运行：
```bash
cpolar authtoken 你的token值
```

### 4. 访问 Web 管理界面

浏览器访问：http://127.0.0.1:9200

用 cpolar 账号登录

## 三、创建隧道

在 cpolar Web 管理界面操作：

### 隧道 1：前端

1. 点击「隧道管理」→「创建隧道」
2. 填写：
   - 隧道名称：`PropBotFrontend`
   - 协议：`http`
   - 本地地址：`5173`
   - 域名类型：随机域名
   - 地区：China Top（默认）
3. 点击「创建」

### 隧道 2：后端

1. 点击「创建隧道」
2. 填写：
   - 隧道名称：`PropBotBackend`
   - 协议：`http`
   - 本地地址：`8080`
   - 域名类型：随机域名
   - 地区：China Top（默认）
3. 点击「创建」

### 获取公网地址

点击「状态」→「在线隧道列表」，记录两个公网地址：
- 前端：`https://xxxxxx.cpolar.top` → localhost:5173
- 后端：`https://yyyyyy.cpolar.top` → localhost:8080

## 四、修改前端配置

### 切换到公网模式

编辑 `frontend/.env.development`：

```bash
# 公网访问时使用 cpolar 穿透地址
VITE_API_BASE_URL=https://你的后端公网地址/api/v1

# 本地开发时使用（公网演示时注释掉）
# VITE_API_BASE_URL=http://localhost:8080/api/v1
```

### 重启前端服务

```bash
cd frontend
# 停止当前服务（Ctrl+C）
npm run dev
```

## 五、测试访问

1. 确保本地服务都在运行：
   - 前端：`npm run dev`（5173 端口）
   - 后端：FastAPI（8080 端口）
   - 数据库：Docker 服务

2. 用手机或其他设备访问前端公网地址

3. 使用测试账号登录：
   - 用户名：`demo`
   - 密码：`demo123`

## 六、恢复本地开发

演示完成后，恢复本地开发配置：

编辑 `frontend/.env.development`：

```bash
# 本地开发时使用
VITE_API_BASE_URL=http://localhost:8080/api/v1

# 公网访问时使用（本地开发时注释掉）
# VITE_API_BASE_URL=https://你的后端公网地址/api/v1
```

重启前端服务即可。

## 注意事项

1. **免费版域名会变**：cpolar 免费版每次重启客户端，域名会随机变化，需要重新修改前端配置

2. **安全提醒**：
   - 不要公开分享公网地址
   - 演示完及时关闭 cpolar
   - 注意 DeepSeek API 余额消耗

3. **服务依赖**：公网访问时，本地所有服务都必须运行：
   - 前端开发服务器
   - 后端 FastAPI
   - Docker 数据库服务（PostgreSQL、Redis、Chroma）
